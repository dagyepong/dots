//============================
//==== Gentoo Niri config ====
//============================

//========================
//====> Input/Output <====
//========================
input {
	keyboard {
		xkb {
		}
		numlock
	}
	focus-follows-mouse max-scroll-amount="0%"
}

output "DP-3" {
	mode "2560x1440@144.002"
	scale 1
	position x=0 y=0
	background-color "#1e1e2e"
	backdrop-color "#6c7086"
}

//==================
//====> Layout <====
//==================
layout {
	gaps 20
	always-center-single-column
	struts {
		left 10
		right 10
		top 10
		bottom 10
	}
	focus-ring { off; }
	border {
		width 4
		active-gradient angle=180 from="#89b4fa" relative-to="window" to="#cba6f7"
		//inactive-gradient angle=45 from="#45475a" relative-to="window" to="#6c7086"
		inactive-color "6c7086"
	}
	insert-hint { color "rgba(127 200 255 50%)"; }
	default-column-width { proportion 0.5; }
	preset-column-widths {
		proportion 0.500000
		proportion 1.000000
	}
	shadow {
		on
		softness 10
		spread 2
		offset x=2 y=2
		color "#11111bB3"
	}
	center-focused-column "never"
}

//======================
//====> Animations <====
//======================
animations {
	// Uncomment to turn off all animations.
	// You can also put "off" into each individual animation to disable it.
	// off

	// Slow down all animations by this factor. Values below 1 speed them up instead.
	// slowdown 3.0

	// Individual animations.

	workspace-switch {
		spring damping-ratio=1.0 stiffness=1000 epsilon=0.0001
	}

	window-open {
		duration-ms 150
		curve "ease-out-expo"
	}

	window-close {
		duration-ms 150
		curve "ease-out-quad"
	}

	horizontal-view-movement {
		spring damping-ratio=1.0 stiffness=800 epsilon=0.0001
	}

	window-movement {
		spring damping-ratio=1.0 stiffness=800 epsilon=0.0001
	}

	window-resize {
		spring damping-ratio=1.0 stiffness=800 epsilon=0.0001
	}

	config-notification-open-close {
		spring damping-ratio=0.6 stiffness=1000 epsilon=0.001
	}

	screenshot-ui-open {
		duration-ms 200
		curve "ease-out-quad"
	}

	overview-open-close {
		spring damping-ratio=1.0 stiffness=800 epsilon=0.0001
	}
}

//====================
//====> Gestures <====
//====================
gestures {
	dnd-edge-view-scroll {
		trigger-width 30
		delay-ms 100
		max-speed 1500
	}

	dnd-edge-workspace-switch {
		trigger-height 50
		delay-ms 100
		max-speed 1500
	}

	hot-corners {
		off
	}
}

//=========================
//====> Miscellaneous <====
//=========================
spawn-at-startup "niristart.sh"
spawn-at-startup "xwayland-satellite"
spawn-at-startup "niriswitcher"
spawn-at-startup "niri" "msg" "action" "focus-workspace 1"

prefer-no-csd
hotkey-overlay { skip-at-startup ;}
screenshot-path "~/Pictures/Screenshots/%Y-%m-%d %H-%M-%S.png"

environment {
    DISPLAY ":0"
}

// Named workspaces
//workspace ""
//workspace ""
//workspace "󱁤"
//workspace ""
//workspace ""
//workspace "󰎄"
//workspace ""
//workspace "󰇮"
//workspace ""

// Overview
overview {
	zoom 0.25
}

//=======================
//====> Layer rules <====
//=======================
layer-rule {
	match namespace="waybar"
	match namespace="gtk-layer-shell"
	match namespace="notifications"
	match namespace="wofi"
	match namespace="rofi"
	match at-startup=true
	shadow {
		on
		softness 10
		spread 2
		offset x=0 y=1
		draw-behind-window false
		color "#11111bB3"
	}
	geometry-corner-radius 12
}

// Put swaybg inside the overview backdrop.
layer-rule {
	match namespace="^wallpaper$"
	place-within-backdrop true
}

//========================
//====> Window rules <====
//========================
window-rule {
	// This regular expression is intentionally made as specific as possible,
	// since this is the default config, and we want no false positives.
	// You can get away with just app-id="wezterm" if you want.
	match app-id=r#"^org\.wezfurlong\.wezterm$"#
	default-column-width {}
}

// Open the Firefox picture-in-picture player as floating by default.
window-rule {
	match app-id=r#"firefox$"# title="^Picture-in-Picture$"
	open-floating true
}

// move steam notifications
window-rule {
	match app-id="steam" title=r#"^notificationtoasts_\d+_desktop$"#
	default-floating-position x=10 y=10 relative-to="bottom-right"
}

// Example: block out two password managers from screen capture.
// (This example rule is commented out with a "/-" in front.)
/-window-rule {
	match app-id=r#"^org\.keepassxc\.KeePassXC$"#
	match app-id=r#"^org\.gnome\.World\.Secrets$"#

	block-out-from "screen-capture"

	// Use this instead if you want them visible on third-party screenshot tools.
	// block-out-from "screencast"
}

window-rule {
	match app-id="kitty"
	open-focused true
	open-on-workspace "1"
}

window-rule {
	match app-id="firefox-bin"
	match app-id="Gimp-2.10"
	match app-id=r#"^org\.inkscape\.Inkscape$"#
	match app-id="steam"
	match app-id="discord"
	match app-id=r#"^org\.squidowl\.halloy$"#
	match app-id="Cider"
	match app-id="rmpc"
	match title="rmpc"
	match app-id="thunderbird"
	match app-id="obsidian"
	open-maximized true
}

window-rule {
	match app-id="gamescope"
	open-fullscreen true
}

window-rule {

	match title="^(file_progress)$"
	match title="^(confirm)$"
	match title="^(dialog)$"
	match title="^(download)$"
	match title="^(notification )$"
	match title="^(error)$"
	match title="^(splash)$"
	match title="^(nwg-look)$"
	match title="^(confirmreset)$"
	match title="^(Delete profile)$"
	match title="^File Operation Progress$"
	match title="^Confirm to replace files$"
	match title="^KDE Connect URL handler$"
	match title="^(Open File)(.*)$"
	match title="^(Select a File)(.*)$"
	match title="^(Choose wallpaper)(.*)$"
	match title="^(Open Folder)(.*)$"
	match title="^(Save As)(.*)$"
	match title="^(Library)(.*)$"
	match title="^(File Upload)(.*)$"
	match title="^(hyprland-share-picker)$"
	match title="^(.*)-Google$"
	match title="^(.*)System Update$"

	match app-id="^xdm-app$"
	match app-id="^org.qbittorrent.qBittorrent$"
	match app-id="^org.pulseaudio.pavucontrol$"

	// Gimp Dialogs
	match title="^(New Layer)$"
	match title="^(Quit GIMP)$"

	match app-id="xfce-polkit"
	match app-id="calcurse"
	match app-id="gcolor3"
	match title="Calculator"
	match app-id=r#"^org\.gnome\.Calculator$"#
	match app-id="Rofi"
	match title="Rename *"
	open-floating true
}

window-rule {
	match app-id="^calcurse$"
	open-floating true
	default-floating-position x=922 y=15 relative-to="top-right"
}

window-rule {
	match title="^calcurse$"
	open-floating true
	default-floating-position x=922 y=15 relative-to="top-right"
}

window-rule {
	match app-id="valent"
	default-column-width { proportion 0.25; }
}

// Example: a "dropdown" terminal.  xfce-polkit
window-rule {
	// Match by "dropdown" app ID.
	// You need to set this app ID when running your terminal, e.g.:
	// spawn "alacritty" "--class" "dropdown"
	match app-id="^dropdown$"

	// Open it as floating.
	open-floating true
	// Anchor to the top edge of the screen.
	default-floating-position x=0 y=0 relative-to="top"
	// Half of the screen high.
	default-window-height { proportion 0.5; }
	// 80% of the screen wide.
	default-column-width { proportion 0.8; }
}

// Example: enable rounded corners for all windows.
// (This example rule is commented out with a "/-" in front.)
window-rule {
	geometry-corner-radius 12
	clip-to-geometry true
}

//=================
//====> Binds <====
//=================
binds {
	Ctrl+Left { spawn "/home/ron/.config/niri/scripts/workspace-left.sh"; }
	Ctrl+Right { spawn "/home/ron/.config/niri/scripts/workspace-right.sh"; }

	Ctrl+WheelScrollDown cooldown-ms=150 { spawn "/home/ron/.config/niri/scripts/workspace-right.sh"; }
	Ctrl+WheelScrollUp cooldown-ms=150 { spawn "/home/ron/.config/niri/scripts/workspace-left.sh"; }
	Alt+WheelScrollDown cooldown-ms=150 { focus-column-right; }
	Alt+WheelScrollUp cooldown-ms=150 { focus-column-left; }

	// Edit niri config
	Alt+C { spawn "mousepad" "/home/ron/.config/niri/config.kdl"; }
	Alt+Shift+C { spawn "thunar" "/home/ron/.config/niri"; }

	// reload dunst
	Alt+D { spawn "sh" "-c" "/home/ron/.config/niri/scripts/reload_dunst.sh"; }

	// restart waybar
	Mod+t { spawn "toggle_waybar_niri.sh"; }

	// niriswitcher
	Alt+Tab repeat=false { spawn "pkill" "-USR1" "niriswitcher"; }
	Alt+Shift+Tab repeat=false { spawn "pkill" "-USR1" "niriswitcher"; }

	// wlogout
	Mod+X hotkey-overlay-title="wlogout" { spawn "sh" "-c" "/home/ron/.config/niri/scripts/niri_wlogout.sh"; }

	// mew
	Alt+P {spawn "sh" "-c" "wmenu-run -b -f 'JetBrainsMono Nerd Font 14' -p run-shit -M 89B4FA -m 1E1E2E -N 1E1E2ED0 -n CBA6F7 -S 89B4FA -s 1E1E2E"; }

	// niri color picker
	Mod+P { spawn "ghostty" "-e" "niri" "msg" "pick-color"; }

	Mod+Shift+Slash { show-hotkey-overlay; }

	// Suggested binds for running programs: terminal, app launcher, screen locker.
	//Mod+T hotkey-overlay-title="Open a Terminal: alacritty" { spawn "alacritty"; }
	Mod+Return hotkey-overlay-title="Open a Terminal: ghostty" { spawn "ghostty"; }
	//Mod+D hotkey-overlay-title="Run an Application: fuzzel" { spawn "fuzzel"; }
	//Mod+D hotkey-overlay-title="Run an Application: wofi" { spawn "wofi"; }
	Mod+D hotkey-overlay-title="Run an Application: wofi" { spawn "sh" "-c" "wofi --show drun -c /home/ron/.config/niri/wofi/config"; }
	//Mod+D hotkey-overlay-title="Run an Application: rofi" { spawn "sh" "-c" "rofi_run_niri -d"; }
	Super+Alt+L hotkey-overlay-title="Lock the Screen: swaylock" { spawn "swaylock"; }

	XF86AudioRaiseVolume allow-when-locked=true { spawn "sh" "-c" "pulsemixer --change-volume +5 --max-volume 100; /home/ron/.config/dunst/scripts/audio-notification-2.sh"; }
	XF86AudioLowerVolume allow-when-locked=true { spawn "sh" "-c" "pulsemixer --change-volume -5; /home/ron/.config/dunst/scripts/audio-notification-2.sh"; }
	XF86AudioMute        allow-when-locked=true { spawn "sh" "-c" "pulsemixer --toggle-mute; /home/ron/.config/dunst/scripts/audio-notification-2.sh"; }
	XF86AudioMicMute     allow-when-locked=true { spawn "wpctl" "set-mute" "@DEFAULT_AUDIO_SOURCE@" "toggle"; }

	XF86AudioPlay        allow-when-locked=true { spawn "playerctl" "play-pause"; }
	XF86AudioPrev        allow-when-locked=true { spawn "playerctl" "previous"; }
	XF86AudioNext        allow-when-locked=true { spawn "playerctl" "next"; }
	XF86AudioStop        allow-when-locked=true { spawn "playerctl" "stop"; }
	XF86Tools { spawn "sh" "-c" "foot --title rmpc --app-id rmpc -e rmpc"; }

	Mod+O repeat=false { toggle-overview; }

	Mod+Shift+Q { close-window; }

	Mod+Left  { focus-column-left; }
	Mod+Down  { focus-window-down; }
	Mod+Up    { focus-window-up; }
	Mod+Right { focus-column-right; }
	Mod+H     { focus-column-left; }
	Mod+J     { focus-window-down; }
	Mod+K     { focus-window-up; }
	Mod+L     { focus-column-right; }

	Mod+Ctrl+Left  { move-column-left; }
	Mod+Ctrl+Down  { move-window-down; }
	Mod+Ctrl+Up    { move-window-up; }
	Mod+Ctrl+Right { move-column-right; }
	Mod+Ctrl+H     { move-column-left; }
	Mod+Ctrl+J     { move-window-down; }
	Mod+Ctrl+K     { move-window-up; }
	Mod+Ctrl+L     { move-column-right; }

	// Alternative commands that move across workspaces when reaching
	// the first or last window in a column.
	// Mod+J     { focus-window-or-workspace-down; }
	// Mod+K     { focus-window-or-workspace-up; }
	// Mod+Ctrl+J     { move-window-down-or-to-workspace-down; }
	// Mod+Ctrl+K     { move-window-up-or-to-workspace-up; }

	Mod+Home { focus-column-first; }
	Mod+End  { focus-column-last; }
	Mod+Ctrl+Home { move-column-to-first; }
	Mod+Ctrl+End  { move-column-to-last; }

	Mod+Shift+Left  { focus-monitor-left; }
	Mod+Shift+Down  { focus-monitor-down; }
	Mod+Shift+Up    { focus-monitor-up; }
	Mod+Shift+Right { focus-monitor-right; }
	Mod+Shift+H     { focus-monitor-left; }
	Mod+Shift+J     { focus-monitor-down; }
	Mod+Shift+K     { focus-monitor-up; }
	Mod+Shift+L     { focus-monitor-right; }

	Mod+Shift+Ctrl+Left  { move-column-to-monitor-left; }
	Mod+Shift+Ctrl+Down  { move-column-to-monitor-down; }
	Mod+Shift+Ctrl+Up    { move-column-to-monitor-up; }
	Mod+Shift+Ctrl+Right { move-column-to-monitor-right; }
	Mod+Shift+Ctrl+H     { move-column-to-monitor-left; }
	Mod+Shift+Ctrl+J     { move-column-to-monitor-down; }
	Mod+Shift+Ctrl+K     { move-column-to-monitor-up; }
	Mod+Shift+Ctrl+L     { move-column-to-monitor-right; }

	// Alternatively, there are commands to move just a single window:
	// Mod+Shift+Ctrl+Left  { move-window-to-monitor-left; }
	//

	// And you can also move a whole workspace to another monitor:
	// Mod+Shift+Ctrl+Left  { move-workspace-to-monitor-left; }
	//

	Mod+Page_Down      { focus-workspace-down; }
	Mod+Page_Up        { focus-workspace-up; }
	Mod+U              { focus-workspace-down; }
	Mod+I              { focus-workspace-up; }
	Mod+Ctrl+Page_Down { move-column-to-workspace-down; }
	Mod+Ctrl+Page_Up   { move-column-to-workspace-up; }
	Mod+Ctrl+U         { move-column-to-workspace-down; }
	Mod+Ctrl+I         { move-column-to-workspace-up; }

	// Alternatively, there are commands to move just a single window:
	// Mod+Ctrl+Page_Down { move-window-to-workspace-down; }
	// ...

	Mod+Shift+Page_Down { move-workspace-down; }
	Mod+Shift+Page_Up   { move-workspace-up; }
	Mod+Shift+U         { move-workspace-down; }
	Mod+Shift+I         { move-workspace-up; }

	// You can bind mouse wheel scroll ticks using the following syntax.
	// These binds will change direction based on the natural-scroll setting.
	//
	// To avoid scrolling through workspaces really fast, you can use
	// the cooldown-ms property. The bind will be rate-limited to this value.
	// You can set a cooldown on any bind, but it's most useful for the wheel.
	Mod+WheelScrollDown      cooldown-ms=150 { focus-workspace-down; }
	Mod+WheelScrollUp        cooldown-ms=150 { focus-workspace-up; }
	Mod+Ctrl+WheelScrollDown cooldown-ms=150 { move-column-to-workspace-down; }
	Mod+Ctrl+WheelScrollUp   cooldown-ms=150 { move-column-to-workspace-up; }

	Mod+WheelScrollRight      { focus-column-right; }
	Mod+WheelScrollLeft       { focus-column-left; }
	Mod+Ctrl+WheelScrollRight { move-column-right; }
	Mod+Ctrl+WheelScrollLeft  { move-column-left; }

	// Usually scrolling up and down with Shift in applications results in
	// horizontal scrolling; these binds replicate that.
	Mod+Shift+WheelScrollDown      { focus-column-right; }
	Mod+Shift+WheelScrollUp        { focus-column-left; }
	Mod+Ctrl+Shift+WheelScrollDown { move-column-right; }
	Mod+Ctrl+Shift+WheelScrollUp   { move-column-left; }

	// Similarly, you can bind touchpad scroll "ticks".
	// Touchpad scrolling is continuous, so for these binds it is split into
	// discrete intervals.
	// These binds are also affected by touchpad's natural-scroll, so these
	// example binds are "inverted", since we have natural-scroll enabled for
	// touchpads by default.
	// Mod+TouchpadScrollDown { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.02+"; }
	// Mod+TouchpadScrollUp   { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.02-"; }

	// You can refer to workspaces by index. However, keep in mind that
	// niri is a dynamic workspace system, so these commands are kind of
	// "best effort". Trying to refer to a workspace index bigger than
	// the current workspace count will instead refer to the bottommost
	// (empty) workspace.
	//
	// For example, with 2 workspaces + 1 empty, indices 3, 4, 5 and so on
	// will all refer to the 3rd workspace.
	Mod+1 { focus-workspace 1; }
	Mod+2 { focus-workspace 2; }
	Mod+3 { focus-workspace 3; }
	Mod+4 { focus-workspace 4; }
	Mod+5 { focus-workspace 5; }
	Mod+6 { focus-workspace 6; }
	Mod+7 { focus-workspace 7; }
	Mod+8 { focus-workspace 8; }
	Mod+9 { focus-workspace 9; }
	Mod+Ctrl+1 { move-column-to-workspace 1; }
	Mod+Ctrl+2 { move-column-to-workspace 2; }
	Mod+Ctrl+3 { move-column-to-workspace 3; }
	Mod+Ctrl+4 { move-column-to-workspace 4; }
	Mod+Ctrl+5 { move-column-to-workspace 5; }
	Mod+Ctrl+6 { move-column-to-workspace 6; }
	Mod+Ctrl+7 { move-column-to-workspace 7; }
	Mod+Ctrl+8 { move-column-to-workspace 8; }
	Mod+Ctrl+9 { move-column-to-workspace 9; }

	// Alternatively, there are commands to move just a single window:
	// Mod+Ctrl+1 { move-window-to-workspace 1; }

	// Switches focus between the current and the previous workspace.
	// Mod+Tab { focus-workspace-previous; }

	// The following binds move the focused window in and out of a column.
	// If the window is alone, they will consume it into the nearby column to the side.
	// If the window is already in a column, they will expel it out.
	Mod+BracketLeft  { consume-or-expel-window-left; }
	Mod+BracketRight { consume-or-expel-window-right; }

	// Consume one window from the right to the bottom of the focused column.
	Mod+Comma  { consume-window-into-column; }
	// Expel the bottom window from the focused column to the right.
	Mod+Period { expel-window-from-column; }

	Mod+R { switch-preset-column-width; }
	Mod+Shift+R { switch-preset-window-height; }
	Mod+Ctrl+R { reset-window-height; }
	Mod+F { maximize-column; }
	Mod+Shift+F { fullscreen-window; }

	// Expand the focused column to space not taken up by other fully visible columns.
	// Makes the column "fill the rest of the space".
	Mod+Ctrl+F { expand-column-to-available-width; }

	Mod+C { center-column; }

	// Center all fully visible columns on screen.
	Mod+Ctrl+C { center-visible-columns; }

	// Finer width adjustments.
	// This command can also:
	// * set width in pixels: "1000"
	// * adjust width in pixels: "-5" or "+5"
	// * set width as a percentage of screen width: "25%"
	// * adjust width as a percentage of screen width: "-10%" or "+10%"
	// Pixel sizes use logical, or scaled, pixels. I.e. on an output with scale 2.0,
	// set-column-width "100" will make the column occupy 200 physical screen pixels.
	Mod+Minus { set-column-width "-10%"; }
	Mod+Equal { set-column-width "+10%"; }

	// Finer height adjustments when in column with other windows.
	Mod+Shift+Minus { set-window-height "-10%"; }
	Mod+Shift+Equal { set-window-height "+10%"; }

	// Move the focused window between the floating and the tiling layout.
	//Mod+V       { toggle-window-floating; }
	Mod+Space     { toggle-window-floating; }
	Mod+Shift+V { switch-focus-between-floating-and-tiling; }

	// Toggle tabbed column display mode.
	// Windows in this column will appear as vertical tabs,
	// rather than stacked on top of each other.
	Mod+W { toggle-column-tabbed-display; }

	// Actions to switch layouts.
	// Note: if you uncomment these, make sure you do NOT have
	// a matching layout switch hotkey configured in xkb options above.
	// Having both at once on the same hotkey will break the switching,
	// since it will switch twice upon pressing the hotkey (once by xkb, once by niri).
	// Mod+Space       { switch-layout "next"; }
	// Mod+Shift+Space { switch-layout "prev"; }

	Print { screenshot; }
	Ctrl+Print { screenshot-screen; }
	Alt+Print { screenshot-window; }

	// Applications such as remote-desktop clients and software KVM switches may
	// request that niri stops processing the keyboard shortcuts defined here
	// so they may, for example, forward the key presses as-is to a remote machine.
	// It's a good idea to bind an escape hatch to toggle the inhibitor,
	// so a buggy application can't hold your session hostage.
	//
	// The allow-inhibiting=false property can be applied to other binds as well,
	// which ensures niri always processes them, even when an inhibitor is active.
	Mod+Escape allow-inhibiting=false { toggle-keyboard-shortcuts-inhibit; }

	// The quit action will show a confirmation dialog to avoid accidental exits.
	Mod+Shift+E { quit; }
	Ctrl+Alt+Delete { quit; }

	// Powers off the monitors. To turn them back on, do any input like
	// moving the mouse or pressing any other key.
	Mod+Shift+P { power-off-monitors; }
}
